<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.hobbyfield.app.club.mapper.CreateclubMapper">

	<!-- 소모임 전체조회 -->
	<select id="selectClubAllList" resultType="CreateclubVO">
		SELECT 
				club_number
			   , profile_nickname
         	   , club_name
			   , FIND_CODE_NM(club_category) AS club_category
			   , FIND_CODE_NM(club_type) AS club_type
			   , club_info
			   , FIND_CODE_NM(major_location) AS major_location
			   , FIND_CODE_NM(sub_location) AS sub_location
			   , club_public
			   , singup_question1
			   , singup_question2
			   , singup_question3
			   , club_img
			   , club_img_path
			   , club_total
		FROM club
		ORDER BY profile_nickname 
	</select>
	
	<!-- (모임장)내가만든 소모임 전체 조회 -->
	<select id="selectClubMyList" resultType="CreateclubVO">
		SELECT 
				c.club_number
			   , p.profile_nickname
			   , m.member_email
         	   , c.club_name
			   , FIND_CODE_NM(c.club_category) AS club_category
			   , FIND_CODE_NM(c.club_type) AS club_type
			   , c.club_info
			   , FIND_CODE_NM(c.major_location) AS major_location
			   , FIND_CODE_NM(c.sub_location) AS sub_location
			   , c.club_public
			   , c.singup_question1
			   , c.singup_question2
			   , c.singup_question3
			   , c.club_img
			   , c.club_img_path
			   , c.club_total
		FROM club c 
		JOIN profile p ON (c.profile_nickname = p.profile_nickname)
		JOIN member m ON (p.member_email = m.member_email)
		WHERE m.member_email = #{memberEmail}
		ORDER BY c.club_number
	</select>
	
	<!-- (모임장)내가만든 소모임 단건 조회 -->
	<select id="selectMadeClub" resultType="CreateclubVO">
		SELECT 
				club_number
			   , profile_nickname
         	   , club_name
			   , FIND_CODE_NM(club_category) AS club_category
			   , FIND_CODE_NM(club_type) AS club_type
			   , club_info
			   , FIND_CODE_NM(major_location) AS major_location
			   , FIND_CODE_NM(sub_location) AS sub_location
			   , club_public
			   , singup_question1
			   , singup_question2
			   , singup_question3
			   , club_img
			   , club_img_path
			   , club_total
		FROM club
		WHERE profile_nickname = #{profileNickname}
	</select>
	
	
	<!-- 소모임 세부조회 -->
	<select id="selectClubInfo" resultType="CreateclubVO">
		SELECT 
				club_number
			   , profile_nickname
         	   , club_name
			   , FIND_CODE_NM(club_category) AS club_category
			   , FIND_CODE_NM(club_type) AS club_type
			   , club_info
			   , FIND_CODE_NM(major_location) AS major_location
			   , FIND_CODE_NM(sub_location) AS sub_location
			   , club_public
			   , singup_question1
			   , singup_question2
			   , singup_question3
			   , club_img
			   , club_img_path
			   , club_total
		FROM club
		WHERE club_number = #{clubNumber}
	</select>
	
	<!-- 소모임 등록 -->
<!-- 	현재 insert All을 사용해야하고 createclubVO에 해당 club_member가 없어서 문제가 생김 -->
<!-- 		INSERT  -->
<!-- 		INTO club_member -->
<!-- 				( -->
<!-- 					club_member_number -->
<!-- 					,profile_nickname -->
<!-- 					,club_number -->
<!-- 					,club_join_date -->
<!-- 				) -->
<!-- 		VALUES	 -->
<!-- 				( -->
<!-- 					(SELECT NVL(MAX(CLUB_MEMBER_NUMBER), 0) + 1 FROM CLUB_member) -->
<!-- 					,#{profileNickname} -->
<!-- 					,#{clubNumber} -->
<!-- 					,#{clubJoinDate} -->
<!-- 				) -->
	<insert id="insertClub" parameterType="CreateclubVO">
		<selectKey keyProperty="clubNumber" resultType="int" order="BEFORE">
			SELECT NVL(MAX(club_number), 0) + 1
			FROM club
		</selectKey>
		INSERT ALL 
		INTO club
				(	
					club_number
					, profile_nickname
					, club_name
					, club_category
					, club_type
					, club_info
					, major_location
					, sub_location
					, club_public
					, singup_question1
					, singup_question2
					, singup_question3
					, club_img
					, club_img_path
					, club_total
				)
		VALUES
				(
					#{clubNumber}
					, #{profileNickname}
					, #{clubName}
					, #{clubCategory}
					, #{clubType}
					, #{clubInfo}
					, #{majorLocation}
					, #{subLocation}
					, #{clubPublic}
					, #{singupQuestion1}
					, #{singupQuestion2}
					, #{singupQuestion3}
					, #{clubImg}
					, #{clubImgPath}
					, 50
				)
	</insert>
	
 	<!-- 닉네임 중복체크 --> 
<!-- 	<select id="nickChk" resultType="int"> -->
<!-- 		SELECT count(*)  -->
<!-- 		FROM club -->
<!-- 		WHERE profile_nickname = #{profileNickname} -->
<!-- 	</select> -->
	
	<!-- 소모임 이름 중복체크 -->
	<select id="clubnameChk" resultType="int">
		SELECT count(*) 
		FROM club
		WHERE club_name = #{clubName}
	</select>
	
	
	<!-- 소모임 수정 전체수정 필요함 0823-->
	<update id="updateClub" parameterType="CreateclubVO">
		UPDATE club
		<set>
			club_number = #{clubNumber}
			, profile_nickname = #{profileNickname}
			, club_name = #{clubName}
			, club_category = #{clubCategory}
			, club_type = #{clubType}
			, club_info = #{clubInfo}
			, major_location = #{majorLocation}
			, sub_location = #{subLocation}
			, club_public = #{clubPublic}
			, singup_question1 = #{singupQuestion1}
			, singup_question2 = #{singupQuestion2}
			, singup_question3 = #{singupQuestion3}
			, club_img = #{clubImg}
			, club_img_path =#{clubImgPath}
		</set>
		WHERE club_name = #{clubName}
	</update>
	
	
	<!-- 소모임 삭제? -->
	

</mapper>