<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.hobbyfield.app.fnd.mapper.FundingPostMapper">
	
	<!-- 전체조회 -->
  	<select id="selectFundingPostList" resultType="FundingPostVO">
  		SELECT
  			Fnd_Main_Img,
  			Fnd_Category,
  			Fnd_Post_Number, 
  			Fnd_Title,
  			Fnd_Start_Date,
  			Fnd_End_Date,
  			Fnd_Status,
  			Fnd_Target_Amount,
  			Fnd_Current_Amount,
  			Fnd_Views,
  			Member_Email
  		FROM Funding_Post
  		ORDER BY Fnd_Post_Number DESC
  	</select>
  	

  	
  	<!-- 단건조회 -->
  	<select id="selectFundingPost" resultType="FundingPostVO">
  		SELECT
  			Fnd_Title,
  			Fnd_Main_Img,
  			Fnd_Main_ImgPath,
  			Fnd_Current_Amount,
  			Fnd_Target_Amount,
  			Fnd_Start_Date,
  			Fnd_End_Date,
  			Fnd_Content,
  			member_Email,
  			Fnd_Participants
  		FROM Funding_Post
  		WHERE Fnd_Post_Number = #{fndPostNumber}
  	</select>
  	
  	
  	<!-- 등록 -->
  	<insert id="insertFundingPost" parameterType="FundingPostVO">
		<selectKey keyProperty="fndPostNumber" resultType="int" order="BEFORE">
			SELECT NVL(MAX(Fnd_Post_Number), 0) + 1
			FROM funding_Post
		</selectKey>
		INSERT INTO funding_Post
				(
				Fnd_Post_Number
				<if test="fndCategory != null">
				, Fnd_Category
				</if>
				<if test="fndTitle != null">
				, Fnd_Title
				</if>
				<if test="fndMainImg != null">
				, Fnd_Main_Img
				</if>
				)
		VALUES( 
				#{fndPostNumber}
				<if test="fndCategory != null">
				, #{fndCategory}
				</if>
				<if test="fndTitle != null">
				, #{fndTitle}
				</if>
				<if test="fndMainImg != null">
				, #{fndMainImg}
				</if>
				)
	</insert>
	
	<!-- 펀딩 임시저장 후 등록 -->
	<update id="updateFundingPost" parameterType="FundingPostVO">
		
		UPDATE Funding_Post
		SET Fnd_Main_Img = #{fndMainImg}
		  , Fnd_Target_Amount = #{fndTargetAmount}
		  , Fnd_Start_Date = #{fndStartDate}
		  , Fnd_End_Date = #{fndEndDate}
		  , Fnd_Wdate = SYSDATE
		WHERE fnd_Post_Number = #{fndPostNumber}
		
	</update>
	
	<!-- , Fnd_Main_Img
				, Fnd_Main_ImgPath
				, Fnd_Target_Amount
				, Fnd_Start_Date
				, Fnd_End_Date
				, Fnd_Wdate
				#{fndMainImg},
				#{fndMainImgPath},
				#{fndTargetAmount},
				#{fndStartDate},
				#{fndEndDate},
				SYSDATE -->
	<!-- 조회수 업데이트 -->
	<update id="FundingPostViewsCount" parameterType="FundingPostVO">
	
		UPDATE Funding_Post
	  	SET Fnd_views = Fnd_views +1
	  	WHERE fnd_Post_Number = #{fndPostNumber}
	  	
	</update>
</mapper>